<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP Gateway - Admin Panel</title>
    <link rel="stylesheet" href="/static/admin.css">
    <script src="/static/admin.js"></script>
</head>
<body>
    <!-- Login Form (shown when auth is enabled and user is not logged in) -->
    <div id="loginContainer" class="login-container hidden">
        <h2 style="text-align: center; margin-bottom: 30px; color: #007AFF;">MCP Gateway Login</h2>
        <div id="loginError" class="error hidden"></div>
        <form id="loginForm" class="login-form">
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button type="submit" class="btn">Login</button>
        </form>
        <p style="margin-top: 20px; text-align: center; color: #666; font-size: 14px;">
            Default credentials: admin / password
        </p>
    </div>

    <!-- Main Admin Panel -->
    <div id="adminPanel" class="container">
        <!-- Auth-specific elements -->
        <button id="logoutBtn" class="btn btn-secondary logout-btn hidden">Logout</button>
        
        <div class="header">
            <h1>MCP Gateway Admin Panel</h1>
            <div id="userInfo" class="user-info hidden"></div>
            <p id="adminDescription">Manage your Model Context Protocol upstream servers</p>
        </div>

        <!-- Auth-specific tabs -->
        <div id="authTabs" class="tabs hidden">
            <div class="tab" data-tab="servers">Upstream Servers</div>
            <div class="tab" data-tab="stats">Statistics</div>
            <div class="tab" data-tab="tokens">Token Management</div>
        </div>

        <!-- Non-auth tabs (no token management) -->
        <div id="noAuthTabs" class="tabs hidden">
            <div class="tab" data-tab="servers">Upstream Servers</div>
            <div class="tab" data-tab="stats">Statistics</div>
        </div>

        <!-- Token Management Tab (auth only) -->
        <div id="tokensTab" class="tab-content hidden">
            <h2>API Access Tokens</h2>
            <p style="margin-bottom: 20px; color: #86868b; font-size: 14px;">
                Create and manage API tokens for external access to the MCP Gateway. These tokens can be used by applications, scripts, or tools to authenticate with the gateway API.
                <br><strong>Note:</strong> Your current login session token is not shown here for security reasons.
            </p>
            <div id="tokenError" class="error hidden"></div>
            <div id="tokenSuccess" class="success hidden"></div>
            
            <div class="create-token-form">
                <h3>Create New API Token</h3>
                <form id="createTokenForm">
                    <div class="form-group">
                        <label for="tokenDescription">Description:</label>
                        <input type="text" id="tokenDescription" name="description" placeholder="e.g., VS Code Extension">
                    </div>
                    <div class="form-group">
                        <label for="tokenExpiry">Expires In (optional):</label>
                        <select id="tokenExpiry" name="expires_in" class="form-input">
                            <option value="14d">14 days</option>
                            <option value="30d">30 days</option>
                            <option value="90d">90 days</option>
                            <option value="1y">1 year</option>
                            <option value="">Never expires</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">Create Token</button>
                </form>
            </div>

            <div id="tokensList" class="tokens-list"></div>
        </div>

        <!-- Statistics Tab -->
        <div id="statsTab" class="tab-content hidden">
            <h2>Gateway Statistics</h2>
            <div class="stats" id="statsContent">
                <div class="stat-card">
                    <div class="stat-number" id="totalServersStats">-</div>
                    <div class="stat-label">Total Servers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="connectedServersStats">-</div>
                    <div class="stat-label">Connected Servers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalToolsStats">-</div>
                    <div class="stat-label">Total Tools</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalResourcesStats">-</div>
                    <div class="stat-label">Total Resources</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="requestsProcessedStats">-</div>
                    <div class="stat-label">Requests Processed</div>
                </div>
            </div>
            
            <div class="actions">
                <button class="btn btn-secondary" onclick="adminPanel.loadStats()">Refresh Statistics</button>
            </div>
            
            <div class="stats-details">
                <h3>Gateway Information</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Gateway Name:</span>
                        <span class="info-value" id="gatewayName">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Gateway Version:</span>
                        <span class="info-value" id="gatewayVersion">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Last Updated:</span>
                        <span class="info-value" id="lastUpdated">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Servers Management Tab -->
        <div id="serversTab" class="tab-content hidden">
            <h2>Upstream Servers</h2>
            <div class="stats" id="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalServers">-</div>
                    <div class="stat-label">Total Servers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="connectedServers">-</div>
                    <div class="stat-label">Connected</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalTools">-</div>
                    <div class="stat-label">Total Tools</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalResources">-</div>
                    <div class="stat-label">Total Resources</div>
                </div>
            </div>
            
            <div class="actions">
                <button class="btn" onclick="showAddServerModal()">Add Server</button>
                <button class="btn btn-secondary" onclick="refreshConnections()">Refresh Connections</button>
                <button class="btn btn-secondary" onclick="loadServers()">Reload</button>
            </div>
            
            <div class="servers-section">
                <div class="servers-header">
                    <h2>Upstream Servers</h2>
                    <span id="serverCount">0 servers</span>
                </div>
                <div class="servers-list" id="serversList">
                    <div class="loading">Loading servers...</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add/Edit Server Modal -->
    <div class="modal" id="serverModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Add Server</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="serverForm">
                <div class="form-group">
                    <label class="form-label">Name *</label>
                    <input type="text" class="form-input" id="serverName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">URL *</label>
                    <input type="url" class="form-input" id="serverUrl" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Type *</label>
                        <select class="form-input" id="serverType" required>
                            <option value="websocket">WebSocket</option>
                            <option value="http">HTTP</option>
                            <option value="stdio">STDIO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Timeout</label>
                        <input type="text" class="form-input" id="serverTimeout" placeholder="30s" value="30s">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Prefix</label>
                    <input type="text" class="form-input" id="serverPrefix" placeholder="Optional prefix for tools/resources">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <input type="text" class="form-input" id="serverDescription" placeholder="Optional description">
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="serverEnabled" checked>
                        <label for="serverEnabled">Enabled</label>
                    </div>
                </div>
                <div class="actions">
                    <button type="submit" class="btn">Save</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
</body>
</html>
